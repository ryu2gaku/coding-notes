# 深拷贝与浅拷贝

## 1. 可变对象与不可变对象

**Python 中一切皆对象**，变量中存放的是对象的引用。如 a=1 中变量 a 存放的只是整数对象 1 的引用。

- 不可变对象 - `int` `float` `str` `tuple`

  ```
  i = 73
  i += 2
  -----------
  i → 73

  i ↘ 73 (垃圾收集)
     75
  ```

- 可变对象 - `list` `dict` `set`

  ```
  m = [5, 9]
  m += [6]
  -----------
  m → [int, int]
        ↓    ↓
        5    9

  m → [int, int, int]
        ↓    ↓    ↓
        5    9    6
  ```

## 2. 深拷贝与浅拷贝

### 2.1. 直接赋值

进行对象引用（内存地址）传递

```py
>>> a = {1: [1, 2, 3]}
>>> b = a
>>> id(a)
4401631096
>>> id(b)
4401631096

"""
id(obj)
Return the identity of an object.
(CPython uses the object's memory address.)
"""
```

```
          ↗ [1, 2, 3]
a → {1: list}
  ↗
 b
```

### 2.2. 浅拷贝 Shadow Copy

```py
>>> import copy
>>> a = {1: [1, 2, 3]}
>>> b = copy.copy(a)
>>> id(a)
4402291768
>>> id(b)
4403860680
>>> a, b
({1: [1, 2, 3]}, {1: [1, 2, 3]})
>>> a[1].append(4)
>>> a, b
({1: [1, 2, 3, 4]}, {1: [1, 2, 3, 4]})
```

```
a → {1: list}
           ↘
            [1, 2, 3]
           ↗
b → {1: list}
```

### 2.3. 深拷贝 Deep Copy

```py
>>> import copy
>>> a = {1: [1, 2, 3]}
>>> b = copy.deepcopy(a)
>>> id(a)
4402291768
>>> id(b)
4403860680
>>> a, b
({1: [1, 2, 3]}, {1: [1, 2, 3]})
>>> a[1].append(4)
>>> a, b
({1: [1, 2, 3, 4]}, {1: [1, 2, 3]})
```

```
          ↗ [1, 2, 3]
a → {1: list}

          ↗ [1, 2, 3]
b → {1: list}
```

### 2.4. 其他操作

切片操作和工厂函数（如 `list()`）也属于浅拷贝

```py
>>> a = [1, 2]
>>> b = [3, 4]
>>> c = [a, b]
>>> d = c[:]
>>> id(c)
4422932168
>>> id(d)
4422932424
>>> c, d
([[1, 2], [3, 4]], [[1, 2], [3, 4]])
>>> a.append(3)
>>> c, d
([[1, 2, 3], [3, 4]], [[1, 2, 3], [3, 4]])
```

### 2.5. 特殊情况

拷贝不可变类型对象时，结果是对象的引用

```py
>>> import copy
>>> a = (1, 2)
>>> b = copy.copy(a)
>>> c = copy.deepcopy(a)
>>> id(a)
4403839240
>>> id(b)
4403839240
>>> id(c)
4403839240
```

特殊情况，元组中的元素有可变类型时，浅拷贝的结果还是对象的引用，深拷贝不是

```py
>>> a = ([1], [2])
>>> b = copy.copy(a)
>>> c = copy.deepcopy(a)
>>> id(a)
4403839432
>>> id(b)
4403839432
>>> id(c)
4403839368
```
