# MAC 地址

MAC 地址（Media Access Control Address 媒体访问控制地址）它是一个用来确认网络设备位置的地址。

在 OSI 模型中，第三层网络层负责 IP 地址，第二层数据链路层则负责 MAC 地址。

MAC 地址是每块网卡的身份标识，具有全球唯一性。MAC 地址采用十六进制标识，共 6 个字节，前三个字节是厂商编号，后三个字节是网卡流水号，例如 4C-0F-6E-12-D2-19

## ARP 协议

ARP（Address Resolution Protocol 地址解析协议）

同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的 MAC 地址。可根据目标主机的 IP 地址，通过 ARP 协议获得其 MAC 地址。

具体工作流程：

- 在本机 ARP 缓存中查找是否有目标 IP 地址。
- 若没有，则将 ARP 请求以广播形式发送到局域网的所有主机（目的 MAC 地址为 FF-FF-FF-FF-FF-FF），局域网的所有主机接收到 ARP 请求后，检查请求 IP 与本机 IP 是否匹配。若不匹配，则丢弃请求。
- 若匹配，则将源主机的 IP 地址和 MAC 地址映射添加到 ARP 缓存中，并将包含自己的 MAC 地址的 ARP 回应直接发送回源主机。
- 当主机收到目标主机发来的 ARP 回应时，会用目标主机的 IP 地址和 MAC 地址映射更新 ARP 缓存。目标主机的 MAC 地址一旦确定，主机就能向目标主机通信了。ARP 缓存是有生存期的，生存期结束后，将再次重复上面的过程。

若主机与目标设备不在同一个局域网上，这种情况主机不需要知道远程设备的 MAC 地址，只需要将 IP 数据报发送给默认网关。

- ARP 缓存有默认网关的 MAC 地址：直接发送 IP 数据报到默认网关，再由网关转发到外网。
- ARP 缓存没有默认网关的 MAC 地址：通过 ARP 请求广播来获取默认网关的 MAC 地址，缓存该地址，并发送 IP 数据报到网关。

```sh
$ arp -a  # 获取本机 ARP 缓存映射表
? (192.168.1.1) at dc:fe:18:29:86:55 on en0 ifscope [ethernet]
? (224.0.0.251) at 1:0:5e:0:0:fb on en0 ifscope permanent [ethernet]
? (239.255.255.250) at 1:0:5e:7f:ff:fa on en0 ifscope permanent [ethernet]
```
