# 端口

在 Internet 上，各主机间通过 TCP/IP 协议发送和接收数据包，各个数据包根据其目的主机的 ip 地址来进行互联网络中的路由选择，将数据包顺利传送到目的主机。但是大多数操作系统都支持多程序（**进程**）同时运行，那么目的主机应该把接收到的数据包传送给哪一个进程，于是，端口机制便由此被引入进来。

本地操作系统会给那些 **有需求的进程分配协议端口**（protocol port，即我们常说的端口），每个协议端口由一个正整数标识，如 80、139、445 等。当目的主机接收到数据包后，将根据 **报文首部的目的端口号**，把数据发送到相应端口，而与此端口相对应的那个进程将会领取数据并等待下一组数据的到来。

端口其实就是队，操作系统为各个进程分配了不同的队，数据包按照目的端口被推入相应的队中，等待被进程取用，在极特殊的情况下，这个队也是有可能溢出的，不过操作系统允许各进程指定和调整自己的队的大小。接受数据包的进程需要开启它自己的端口，发送数据包的进程也需要开启端口，这样，数据包中将会标识源端口，以便接受方能顺利的回传数据包到这个端口。

端口使用一个 16 位的数字表示，可允许有 65536（2<sup>16</sup>）个不同的端口号，范围在 0 到 65535 之间。

## 端口的分类

- **公认端口**（Well Known Ports）- 端口号范围在 0 ~ 1023 之间，紧密绑定于一些服务
  | 协议 | 默认端口号 | 基本作用 |
  | :----: | :--------: | :---------------: |
  | FTP | 21 | 文件上传下载 |
  | SSH | 22 | 安全的远程登陆 |
  | TELNET | 23 | 远程登陆 |
  | SMTP | 25 | 邮件传输 |
  | DNS | 53 | 域名解析 |
  | HTTP | 80 | 超文本传输 |
  | POP3 | 110 | 邮件接收 |
  | HTTPS | 443 | 加密的 HTTP |
- **注册端口**（Registered Ports）- 端口号范围在 1024 ~ 49151 之间
- **动态和／或私有端口**（Dynamic and/or Private Ports）- 端口号范围在 49152 ~ 65535 之间

## 端口查看

`netstat` 命令是一个监控 TCP/IP 网络的非常有用的工具，它可以显示路由表、实际的网络连接以及每一个网络接口设备的状态信息。

```sh
-a 或 --all # 显示所有连线中的 Socket
-A<网络类型> 或 --<网络类型> # 列出该网络类型连线中的相关地址
-c 或 --continuous # 持续列出网络状态
-C 或 --cache # 显示路由器配置的快取信息
-e 或 --extend # 显示网络其他相关信息
-F 或 --fib # 显示 FIB
-g 或 --groups # 显示多重广播功能群组组员名单
-h 或 --help # 在线帮助
-i 或 --interfaces # 显示网络界面信息表单
-l 或 --listening # 显示监控中的服务器的 Socket
-M 或 --masquerade # 显示伪装的网络连线
-n 或 --numeric # 直接使用 IP 地址, 而不通过域名服务器
-N 或 --netlink 或 --symbolic # 显示网络硬件外围设备的符号连接名称
-o 或 --timers # 显示计时器
-p 或 --programs # 显示正在使用 Socket 的程序识别码和程序名称
-r 或 --route # 显示 Routing Table
-s 或 --statistice # 显示网络工作信息统计表
-t 或 --tcp # 显示 TCP 传输协议的连线状况
-u 或 --udp # 显示 UDP 传输协议的连线状况
-v 或 --verbose # 显示指令执行过程
-V 或 --version # 显示版本信息
-w 或 --raw # 显示 RAW 传输协议的连线状况
-x 或 --unix # 此参数的效果和指定 "-A unix" 参数相同
--ip 或 --inet # 此参数的效果和指定 "-A inet" 参数相同
```

```sh
# 查看端口状态
$ netstat -an
$ netstat -an | grep 22 # 查询所有含有 22 的端口使用情况

# lsof -i [tcp/udp] :端口号
# 查看端口号被哪个程序占用
$ sudo lsof -i :22
```
